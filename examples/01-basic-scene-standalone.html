<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Three.js TypeScript Tutorial - 01 Basic Scene</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				margin: 0;
				background-color: #000;
				color: #fff;
				font-family: Monospace;
				font-size: 13px;
				line-height: 24px;
				overscroll-behavior: none;
			}

			#info {
				position: absolute;
				top: 0px;
				width: 100%;
				padding: 10px;
				box-sizing: border-box;
				text-align: center;
				z-index: 1;
				pointer-events: none;
			}

			#controls {
				position: absolute;
				bottom: 10px;
				left: 10px;
				background: rgba(0, 0, 0, 0.7);
				padding: 15px;
				border-radius: 8px;
				pointer-events: auto;
			}

			#controls button {
				background: transparent;
				border: 1px solid #fff;
				color: #fff;
				padding: 8px 12px;
				margin: 4px;
				border-radius: 4px;
				cursor: pointer;
				font-family: monospace;
			}

			#controls button:hover {
				background: rgba(255, 255, 255, 0.1);
			}

			#controls input[type="color"] {
				width: 40px;
				height: 30px;
				border: none;
				border-radius: 4px;
				margin: 4px;
				cursor: pointer;
			}

			.tutorial-title {
				font-size: 16px;
				font-weight: bold;
				margin-bottom: 5px;
				color: #ffff00;
			}

			.tutorial-description {
				font-size: 12px;
				opacity: 0.8;
			}

			.type-info {
				background: rgba(0, 255, 255, 0.1);
				padding: 8px;
				margin: 4px 0;
				border-radius: 4px;
				font-size: 11px;
				border-left: 3px solid #00ffff;
			}
		</style>
	</head>
	<body>
		<div id="info">
			<div class="tutorial-title">Three.js TypeScript Tutorial - 01 Basic Scene</div>
			<div class="tutorial-description">å‹å®‰å…¨ãªåŸºæœ¬ã‚·ãƒ¼ãƒ³ã®å®Ÿè£… - ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ</div>
			<div class="type-info">
				TypeScript Features: å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ã‚¯ãƒ©ã‚¹ã€ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹
			</div>
		</div>

		<div id="controls">
			<div>ğŸ¨ Color: <input type="color" id="colorPicker" value="#00ff00"></div>
			<button id="resetBtn">Reset Position</button>
			<button id="stopBtn">Stop Animation</button>
			<button id="startBtn">Start Animation</button>
		</div>

		<!-- Three.js CDN -->
		<script type="importmap">
			{
				"imports": {
					"three": "https://unpkg.com/three@0.178.0/build/three.module.js"
				}
			}
		</script>

		<script type="module">
			import * as THREE from 'three';

			/**
			 * åŸºæœ¬çš„ãªThree.jsã‚·ãƒ¼ãƒ³ã‚¯ãƒ©ã‚¹ (TypeScripté¢¨ã®å®Ÿè£…)
			 */
			class BasicScene {
				constructor(config = {}) {
					// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
					const defaultConfig = {
						camera: {
							fov: 75,
							aspect: window.innerWidth / window.innerHeight,
							near: 0.1,
							far: 1000,
							position: new THREE.Vector3(0, 0, 5)
						},
						renderer: {
							antialias: true,
							alpha: false
						},
						scene: {
							background: new THREE.Color(0x222222)
						}
					};

					const mergedConfig = this.mergeConfig(defaultConfig, config);
					
					// ã‚«ãƒ¡ãƒ©ã®ä½œæˆ
					this.camera = new THREE.PerspectiveCamera(
						mergedConfig.camera.fov,
						mergedConfig.camera.aspect,
						mergedConfig.camera.near,
						mergedConfig.camera.far
					);
					this.camera.position.copy(mergedConfig.camera.position);

					// ã‚·ãƒ¼ãƒ³ã®ä½œæˆ
					this.scene = new THREE.Scene();
					this.scene.background = mergedConfig.scene.background;

					// ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®ä½œæˆ
					this.renderer = new THREE.WebGLRenderer(mergedConfig.renderer);
					this.renderer.setPixelRatio(window.devicePixelRatio);
					this.renderer.setSize(window.innerWidth, window.innerHeight);

					// ã‚­ãƒ¥ãƒ¼ãƒ–ã®ä½œæˆ
					this.cube = this.createCube();
					this.scene.add(this.cube);

					// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
					this.setupEventListeners();
					
					this.animationId = null;
				}

				/**
				 * è¨­å®šã®ãƒãƒ¼ã‚¸
				 */
				mergeConfig(defaultConfig, userConfig) {
					return {
						camera: { ...defaultConfig.camera, ...userConfig.camera },
						renderer: { ...defaultConfig.renderer, ...userConfig.renderer },
						scene: { ...defaultConfig.scene, ...userConfig.scene }
					};
				}

				/**
				 * ã‚­ãƒ¥ãƒ¼ãƒ–ã®ä½œæˆ
				 */
				createCube() {
					const geometry = new THREE.BoxGeometry(1, 1, 1);
					const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
					return new THREE.Mesh(geometry, material);
				}

				/**
				 * ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
				 */
				setupEventListeners() {
					window.addEventListener('resize', this.onWindowResize.bind(this));
				}

				/**
				 * ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå‡¦ç†
				 */
				onWindowResize() {
					this.camera.aspect = window.innerWidth / window.innerHeight;
					this.camera.updateProjectionMatrix();
					this.renderer.setSize(window.innerWidth, window.innerHeight);
				}

				/**
				 * ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
				 */
				animate() {
					this.animationId = requestAnimationFrame(this.animate.bind(this));
					
					// ã‚­ãƒ¥ãƒ¼ãƒ–ã®å›è»¢
					this.cube.rotation.x += 0.01;
					this.cube.rotation.y += 0.01;

					this.renderer.render(this.scene, this.camera);
				}

				/**
				 * ã‚·ãƒ¼ãƒ³ã®é–‹å§‹
				 */
				start() {
					if (!document.body.contains(this.renderer.domElement)) {
						document.body.appendChild(this.renderer.domElement);
					}
					this.animate();
				}

				/**
				 * ã‚·ãƒ¼ãƒ³ã®åœæ­¢
				 */
				stop() {
					if (this.animationId !== null) {
						cancelAnimationFrame(this.animationId);
						this.animationId = null;
					}
				}

				/**
				 * ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
				 */
				dispose() {
					this.stop();
					
					// ã‚¸ã‚ªãƒ¡ãƒˆãƒªã¨ãƒãƒ†ãƒªã‚¢ãƒ«ã®ç ´æ£„
					this.cube.geometry.dispose();
					this.cube.material.dispose();
					
					// ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®ç ´æ£„
					this.renderer.dispose();
					
					// DOMè¦ç´ ã®å‰Šé™¤
					if (document.body.contains(this.renderer.domElement)) {
						document.body.removeChild(this.renderer.domElement);
					}
					
					// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®å‰Šé™¤
					window.removeEventListener('resize', this.onWindowResize.bind(this));
				}

				/**
				 * ã‚­ãƒ¥ãƒ¼ãƒ–ã®è‰²ã‚’å¤‰æ›´
				 */
				setCubeColor(color) {
					this.cube.material.color.set(color);
				}

				/**
				 * ã‚«ãƒ¡ãƒ©ä½ç½®ã®è¨­å®š
				 */
				setCameraPosition(x, y, z) {
					this.camera.position.set(x, y, z);
				}
			}

			// ã‚·ãƒ¼ãƒ³è¨­å®š
			const sceneConfig = {
				camera: {
					fov: 75,
					position: new THREE.Vector3(0, 0, 5)
				},
				renderer: {
					antialias: true,
					alpha: false
				},
				scene: {
					background: new THREE.Color(0x222222)
				}
			};

			// ã‚·ãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ
			const scene = new BasicScene(sceneConfig);
			
			// ã‚·ãƒ¼ãƒ³ã®é–‹å§‹
			scene.start();

			// UI ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®è¨­å®š
			setupControls(scene);

			/**
			 * UIã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®è¨­å®š
			 */
			function setupControls(sceneInstance) {
				const colorPicker = document.getElementById('colorPicker');
				const resetBtn = document.getElementById('resetBtn');
				const stopBtn = document.getElementById('stopBtn');
				const startBtn = document.getElementById('startBtn');

				// è‰²å¤‰æ›´
				colorPicker?.addEventListener('change', (event) => {
					sceneInstance.setCubeColor(event.target.value);
				});

				// ã‚«ãƒ¡ãƒ©ä½ç½®ãƒªã‚»ãƒƒãƒˆ
				resetBtn?.addEventListener('click', () => {
					sceneInstance.setCameraPosition(0, 0, 5);
				});

				// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡
				stopBtn?.addEventListener('click', () => {
					sceneInstance.stop();
				});

				startBtn?.addEventListener('click', () => {
					sceneInstance.start();
				});
			}

			// ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒšãƒ¼ã‚¸é›¢è„±æ™‚ï¼‰
			window.addEventListener('beforeunload', () => {
				scene.dispose();
			});

			// é–‹ç™ºè€…å‘ã‘æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
			console.group('ğŸš€ Three.js TypeScript Tutorial');
			console.log('ğŸ“¦ Scene instance:', scene);
			console.log('ğŸ¥ Camera:', scene.camera);
			console.log('ğŸ­ Scene:', scene.scene);
			console.log('ğŸ–¥ï¸ Renderer:', scene.renderer);
			console.log('ğŸ’¡ TypeScript-like implementation with type safety concepts');
			console.groupEnd();
		</script>

	</body>
</html>